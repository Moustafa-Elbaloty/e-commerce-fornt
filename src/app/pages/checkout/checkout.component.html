<div class="container">
  <h1>Checkout</h1>
  <div class="subtitle">
    Finalize your purchase by providing shipping and payment details.
  </div>

  <div class="checkout-grid">

    <!-- ================= Shipping Information ================= -->
    <div class="card">
      <h2>Shipping Information</h2>

      <form name="shippingForm">
        <div class="form-row">
          <div class="form-group">
            <label>First Name</label>
            <input
              type="text"
              name="firstName"
              [(ngModel)]="shipping.firstName"
              (keypress)="allowOnlyLetters($event)"
              (input)="cleanName('firstName')"
              [class.error]="submitted && isEmpty(shipping.firstName)"
            >
          </div>

          <div class="form-group">
            <label>Last Name</label>
            <input
              type="text"
              name="lastName"
              [(ngModel)]="shipping.lastName"
              (keypress)="allowOnlyLetters($event)"
              (input)="cleanName('lastName')"
              [class.error]="submitted && isEmpty(shipping.lastName)"
            >
          </div>
        </div>

        <div class="form-group">
          <label>Address Line 1</label>
          <input
            type="text"
            name="address1"
            [(ngModel)]="shipping.address1"
            [class.error]="submitted && isEmpty(shipping.address1)"
          >
        </div>

        <div class="form-group">
          <label>Address Line 2</label>
          <input
            type="text"
            name="address2"
            [(ngModel)]="shipping.address2"
            [class.error]="submitted && isEmpty(shipping.address2)"
          >
        </div>

        <div class="form-group">
          <label>Governorate</label>
          <select
            name="governorate"
            [(ngModel)]="shipping.governorate"
            [class.error]="submitted && isEmpty(shipping.governorate)"
          >
            <option value="">Select Governorate</option>
            <option *ngFor="let g of egyptGovernorates" [value]="g">
              {{ g }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>City</label>
          <input
            type="text"
            name="city"
            [(ngModel)]="shipping.city"
            (keypress)="allowOnlyLetters($event)"
            (input)="cleanName('city')"
            [class.error]="submitted && isEmpty(shipping.city)"
          >
        </div>

        <div class="form-group">
          <label>Phone</label>
          <input
            type="tel"
            name="phone"
            [(ngModel)]="shipping.phone"
            (keypress)="allowOnlyNumbers($event)"
            (input)="formatPhone()"
            maxlength="11"
            placeholder="01XXXXXXXXX"
            [class.error]="submitted && invalidPhone()"
          >
        </div>
      </form>
    </div>

    <!-- ================= Order Summary ================= -->
    <div class="card order-summary">
      <h2>Order Summary</h2>

      <div class="order-item" *ngFor="let item of cartItems">
        <img
          [src]="item.product.image"
          [alt]="item.product.name"
        >
        <div>
          {{ item.product.name }} (x{{ item.quantity }})
        </div>
        <div>
          ${{ item.product.price * item.quantity }}
        </div>
      </div>

      <div class="summary-line">
        <span>Subtotal</span>
        <span>${{ subtotal }}</span>
      </div>

      <div class="summary-line">
        <span>Shipping</span>
        <span>${{ shippingCost }}</span>
      </div>

      <div class="summary-line total">
        <span>Total</span>
        <span>${{ total }}</span>
      </div>

      <button class="btn" (click)="placeOrder()">
        Place Order
      </button>

      <p class="error-msg" *ngIf="formError">
        ⚠️ {{ formError }}
      </p>
    </div>

    <!-- ================= Payment Method ================= -->
    <div class="card">
      <h2>Payment Method</h2>

      <div class="payment-options">
        <label>
          <input
            type="radio"
            name="paymentType"
            value="paymob"
            [(ngModel)]="paymentType"
          >
          Credit Card (Paymob)
        </label>

        <label>
          <input
            type="radio"
            name="paymentType"
            value="cash"
            [(ngModel)]="paymentType"
          >
          Cash on Delivery
        </label>
      </div>
    </div>

  </div>
</div>
